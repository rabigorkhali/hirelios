function MenuEditor(e,s){var t=$("#"+e).data("level","0"),l={labelEdit:'<i class="fas fa-edit clickable"></i>',labelRemove:'<i class="fas fa-trash-alt clickable"></i>',textConfirmDelete:"This item will be deleted. Are you sure?",iconPicker:{cols:4,rows:4,footer:!1,iconset:"fontawesome5"},maxLevel:-1,listOptions:{hintCss:{border:"1px dashed #13981D"},opener:{as:"html",close:'<i class="fas fa-minus"></i>',open:'<i class="fas fa-plus"></i>',openerCss:{"margin-right":"10px"},openerClass:"btn btn-success btn-sm d-inline-flex align-items-center"},placeholderCss:{"background-color":"gray"},ignoreClass:"clickable",listsClass:"list-unstyled",listsCss:{"padding-top":"10px"},complete:function(e){return MenuEditor.updateButtons(t),t.updateLevels(0),!0},isAllowed:function(e,s,t){return f(e,t)}}};$.extend(!0,l,s);var n=null,i=!0,o=null,r=null,a=l.iconPicker,s=l.listOptions,c=$("#"+e+"_icon").iconpicker(a);function d(){o[0].reset(),(c=c.iconpicker(a)).iconpicker("setIcon","empty"),r.attr("disabled",!0),n=null}function p(e){return $("<a>").addClass(e.classCss).addClass("clickable").attr("href","#").html(e.text)}function u(){var e=$("<div>").addClass("btn-group float-end"),s=p({classCss:"btn btn-primary btn-sm btnEdit",text:l.labelEdit}),t=p({classCss:"btn btn-danger btn-sm btnRemove",text:l.labelRemove}),n=p({classCss:"btn btn-secondary btn-sm btnUp btnMove",text:'<i class="fas fa-angle-up clickable"></i>'}),i=p({classCss:"btn btn-secondary btn-sm btnDown btnMove",text:'<i class="fas fa-angle-down clickable"></i>'}),o=p({classCss:"btn btn-secondary btn-sm btnOut btnMove",text:'<i class="fas fa-level-down-alt clickable"></i>'}),r=p({classCss:"btn btn-secondary btn-sm btnIn btnMove",text:'<i class="fas fa-level-up-alt clickable"></i>'});return e.append(n).append(i).append(r).append(o).append(s).append(t),e}function h(e){$("<span>").addClass("sortableListsOpener "+s.opener.openerClass).css(s.opener.openerCss).on("mousedown touchstart",function(e){var t=$(this).closest("li");return t.hasClass("sortableListsClosed")?t.iconOpen(s):t.iconClose(s),!1}).prependTo(e.children("div").first()),e.hasClass("sortableListsOpen")?e.iconOpen(s):e.iconClose(s)}function f(e,s){if(l.maxLevel<0)return!0;var t=0,n=e.find("ul").length;return t=0==s.length?0:parseInt(s.parent().data("level"))+1,console.log(t+n),t+n<=l.maxLevel}t.sortableLists(l.listOptions),c.on("change",function(e){o.find("[name=icon]").val(e.icon)}),t.on("click",".btnRemove",function(s){if(s.preventDefault(),confirm(l.textConfirmDelete)){var n=$(this).closest("ul");$(this).closest("li").remove();var i=!1;void 0!==n.attr("id")&&(i=n.attr("id").toString()===e),n.children().length||i||(n.prev("div").children(".sortableListsOpener").first().remove(),n.remove()),MenuEditor.updateButtons(t)}}),t.on("click",".btnEdit",function(e){var s,t;e.preventDefault(),t=(s=n=$(this).closest("li")).data(),$.each(t,function(e,s){o.find("[name="+e+"]").val(s)}),o.find(".item-menu").first().focus(),t.hasOwnProperty("icon")?c.iconpicker("setIcon",t.icon):c.iconpicker("setIcon","empty"),r.removeAttr("disabled")}),t.on("click",".btnUp",function(e){e.preventDefault();var s=$(this).closest("li");s.prev("li").before(s),MenuEditor.updateButtons(t)}),t.on("click",".btnDown",function(e){e.preventDefault();var s=$(this).closest("li");s.next("li").after(s),MenuEditor.updateButtons(t)}),t.on("click",".btnOut",function(e){e.preventDefault();var s=$(this).closest("ul"),l=$(this).closest("li");l.closest("ul").closest("li").after(l),s.children().length<=0&&(s.prev("div").children(".sortableListsOpener").first().remove(),s.remove()),MenuEditor.updateButtons(t),t.updateLevels()}),t.on("click",".btnIn",function(e){e.preventDefault();var s=$(this).closest("li"),l=s.prev("li");if(!f(s,l))return!1;if(l.length>0){var n=l.children("ul");if(n.length>0)n.append(s);else{var n=$("<ul>").addClass("list-unstyled").css("padding-top","10px");l.append(n),n.append(s),l.addClass("sortableListsOpen"),h(l)}}MenuEditor.updateButtons(t),t.updateLevels()}),this.setForm=function(e){o=e},this.getForm=function(){return o},this.setUpdateButton=function(e){(r=e).attr("disabled",!0),n=null},this.getUpdateButton=function(){return r},this.getCurrentItem=function(){return n},this.update=function(){var e=this.getCurrentItem();if(null!==e){var s=e.data("icon");o.find(".item-menu").each(function(){var t=$(this).attr("name"),l=$(this).val();e.data(t,l),"icon"===t&&(s=s||"",l=l||"",e.find("i").first().removeClass(s).addClass(l))}),e.find("span.txt").first().text(e.data("text")),d()}},this.add=function(){var e={};o.find(".item-menu").each(function(){e[$(this).attr("name")]=$(this).val()}),u(),$("<span>").addClass("txt").text(e.text),$("<i>").addClass(e.icon);var s=$("<div>").addClass("d-flex justify-content-between align-items-center"),l=$("<div>").addClass("d-flex align-items-center"),n=$("<i>").addClass(e.icon),i=$("<span>").addClass("txt ms-2").append(e.text),r=u();l.append(n).append(i),s.append(l).append(r);var a=$("<li>").data(e);a.addClass("list-group-item pe-0").append(s),t.append(a),MenuEditor.updateButtons(t),d()},this.getString=function(){return JSON.stringify(t.sortableListsToJson())},this.setData=function(e){var s=Array.isArray(e)?e:function e(s){try{var t=JSON.parse(s)}catch(l){return console.log("The string is not a json valid."),null}return t}(e);if(null!==s){t.empty();var n=function e(s,l){var n=void 0===l?0:l,i=0===n?t:$("<ul>").addClass("list-unstyled").css("padding-top","10px").data("level",n);return $.each(s,function(s,t){var l=void 0!==t.children&&$.isArray(t.children),o={text:"",href:"",icon:"empty",target:"_self",title:""},r=$.extend({},t);l&&delete r.children,$.extend(o,r);var a=$("<li>").addClass("list-group-item pe-0");a.data(o);var c=$("<div>").addClass("d-flex justify-content-between align-items-center"),d=$("<div>").addClass("d-flex align-items-center"),p=$("<i>").addClass(t.icon),h=$("<span>").addClass("txt ms-2").append(t.text),f=u();d.append(p).append(h),c.append(d).append(f),a.append(c),l&&a.append(e(t.children,n+1)),i.append(a)}),i}(s);i?t.find("li").each(function(){var e=$(this);e.children("ul").length&&h(e)}):(n.sortableLists(l.listOptions),i=!0),MenuEditor.updateButtons(t)}}}!function(e){/**
     * @desc jQuery plugin to sort html list also the tree structures
     * @version 1.4.0
     * @author Vladimír Čamaj
     * @license MIT
     * @desc jQuery plugin
     * @param options
     * @returns this to unsure chaining
     */ e.fn.sortableLists=function(s){var t=e("body").css("position","relative"),l={currElClass:"",placeholderClass:"",placeholderCss:{position:"relative",padding:0},hintClass:"",hintCss:{display:"none",position:"relative",padding:0},hintWrapperClass:"",hintWrapperCss:{},baseClass:"",baseCss:{position:"absolute",top:0-parseInt(t.css("margin-top")),left:0-parseInt(t.css("margin-left")),margin:0,padding:0,"z-index":2500},opener:{active:!1,open:"",close:"",openerCss:{float:"left",display:"inline-block","background-position":"center center","background-repeat":"no-repeat"},openerClass:""},listSelector:"ul",listsClass:"",listsCss:{},insertZone:50,insertZonePlus:!1,scroll:20,ignoreClass:"",isAllowed:function(e,s,t){return!0},onDragStart:function(e,s){return!0},onChange:function(e){return!0},complete:function(e){return!0}},n=e.extend(!0,{},l,s),i=e("<"+n.listSelector+" />").prependTo(t).attr("id","sortableListsBase").css(n.baseCss).addClass(n.listsClass+" "+n.baseClass),o=e("<li />").attr("id","sortableListsPlaceholder").css(n.placeholderCss).addClass(n.placeholderClass),r=e("<li />").attr("id","sortableListsHint").css(n.hintCss).addClass(n.hintClass),a=e("<"+n.listSelector+" />").attr("id","sortableListsHintWrapper").addClass(n.listsClass+" "+n.hintWrapperClass).css(n.listsCss).css(n.hintWrapperCss),c=e("<span />").addClass("sortableListsOpener "+n.opener.openerClass).css(n.opener.openerCss).on("mousedown touchstart",function(s){var t=e(this).closest("li");return t.hasClass("sortableListsClosed")?g(t):b(t),!1});"class"==n.opener.as?c.addClass(n.opener.close):"html"==n.opener.as?c.html(n.opener.close):console.error("Invalid setting for opener.as");var d={isDragged:!1,isRelEFP:null,oEl:null,rootEl:null,cEl:null,upScroll:!1,downScroll:!1,pX:0,pY:0,cX:0,cY:0,isAllowed:!0,e:{pageX:0,pageY:0,clientX:0,clientY:0},doc:e(document),win:e(window)};if(n.opener.active){if(!n.opener.open)throw"Opener.open value is not defined. It should be valid url, html or css class.";if(!n.opener.close)throw"Opener.close value is not defined. It should be valid url, html or css class.";e(this).find("li").each(function(){var s=e(this);s.children(n.listSelector).length&&(c.clone(!0).prependTo(s.children("div").first()),s.hasClass("sortableListsOpen")?g(s):b(s))})}return this.on("mousedown touchstart",function(s){var t=e(s.target);if(!(!1!==d.isDragged||n.ignoreClass&&t.hasClass(n.ignoreClass))){s.preventDefault(),"touchstart"===s.type&&v(s);var l,a,c,h,f,g,b,m,C,L,E=t.closest("li"),y=e(this);E[0]&&(n.onDragStart(s,E),l=s,a=E,c=y,d.isDragged=!0,h=parseInt(a.css("margin-top")),f=parseInt(a.css("margin-bottom")),g=parseInt(a.css("margin-left")),b=parseInt(a.css("margin-right")),m=a.offset(),C=a.innerHeight(),d.rootEl={el:c,offset:c.offset(),rootElClass:c.attr("class")},d.cEl={el:a,mT:h,mL:g,mB:f,mR:b,offset:m},d.cEl.xyOffsetDiff={X:l.pageX-d.cEl.offset.left,Y:l.pageY-d.cEl.offset.top},d.cEl.el.addClass("sortableListsCurrent "+n.currElClass),a.before(o),L=d.placeholderNode=e("#sortableListsPlaceholder"),a.css({width:a.width(),position:"absolute",top:m.top-h,left:m.left-g}).prependTo(i),L.css({display:"block",height:C}),r.css("height",C),d.doc.on("mousemove touchmove",p).on("mouseup touchend touchcancel",u))}});function p(s){if(d.isDragged){var t,l,i,o,c,p,u=d.cEl,b=d.doc,m=d.win;"touchmove"===s.type&&v(s),s.pageX||(t=s,t.pageY=d.pY,t.pageX=d.pX,t.clientY=d.cY,t.clientX=d.cX),b.scrollTop()>d.rootEl.offset.top-10&&s.clientY<50?d.upScroll?(s.pageY=s.pageY-n.scroll,e("html, body").each(function(s){e(this).scrollTop(e(this).scrollTop()-n.scroll)}),h(s)):(l=s,d.upScroll||(d.upScroll=setInterval(function(){d.doc.trigger("mousemove")},50))):b.scrollTop()+m.height()<d.rootEl.offset.top+d.rootEl.el.outerHeight(!1)+10&&m.height()-s.clientY<50?d.downScroll?(s.pageY=s.pageY+n.scroll,e("html, body").each(function(s){e(this).scrollTop(e(this).scrollTop()+n.scroll)}),h(s)):(i=s,d.downScroll||(d.downScroll=setInterval(function(){d.doc.trigger("mousemove")},50))):f(d),d.oElOld=d.oEl,u.el[0].style.visibility="hidden",d.oEl=oEl=function s(t,l){if(!document.elementFromPoint)return null;var n,i,o=d.isRelEFP;null===o&&((n=d.doc.scrollTop())>0&&(o=null==(i=document.elementFromPoint(0,n+e(window).height()-1))||"HTML"==i.tagName.toUpperCase()),(n=d.doc.scrollLeft())>0&&(o=null==(i=document.elementFromPoint(n+e(window).width()-1,0))||"HTML"==i.tagName.toUpperCase())),o&&(t-=d.doc.scrollLeft(),l-=d.doc.scrollTop());var r=e(document.elementFromPoint(t,l));return!d.rootEl.el.find(r).length||r.is("#sortableListsPlaceholder")||r.is("#sortableListsHint")?null:r.is("li")?r.is("li")?r:void 0:(r=r.closest("li"))[0]?r:null}(s.pageX,s.pageY),u.el[0].style.visibility="visible",function s(t,l){var i=l.oEl;if(i&&l.oElOld){var o=i.outerHeight(!1),c=t.pageY-i.offset().top;n.insertZonePlus?14>c?function s(t,l,i){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&r.unwrap(),!i&&t.pageX-l.offset().left>n.insertZone){var o=l.children(),c=l.children(n.listSelector).first();if(c.children().first().is("#sortableListsPlaceholder")){r.css("display","none");return}c.length?c.prepend(r):(o.first().after(r),r.wrap(a)),d.oEl&&g(l)}else{if(l.prev("#sortableListsPlaceholder").length){r.css("display","none");return}l.before(r)}r.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,r,r.parents("li").first())}(t,i,7>c):o-14<c&&function s(t,l,i){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&r.unwrap(),!i&&t.pageX-l.offset().left>n.insertZone){var o=l.children(),c=l.children(n.listSelector).last();if(c.children().last().is("#sortableListsPlaceholder")){r.css("display","none");return}c.length?o.last().append(r):(l.append(r),r.wrap(a)),d.oEl&&g(l)}else{if(l.next("#sortableListsPlaceholder").length){r.css("display","none");return}l.after(r)}r.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,r,r.parents("li").first())}(t,i,o-7<c):5>c?function s(t,l){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&r.unwrap(),t.pageX-l.offset().left<n.insertZone){if(l.prev("#sortableListsPlaceholder").length){r.css("display","none");return}l.before(r)}else{var i=l.children(),o=l.children(n.listSelector).first();if(o.children().first().is("#sortableListsPlaceholder")){r.css("display","none");return}o.length?o.prepend(r):(i.first().after(r),r.wrap(a)),d.oEl&&g(l)}r.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,r,r.parents("li").first())}(t,i):o-5<c&&function s(t,l){if(e("#sortableListsHintWrapper",d.rootEl.el).length&&r.unwrap(),t.pageX-l.offset().left<n.insertZone){if(l.next("#sortableListsPlaceholder").length){r.css("display","none");return}l.after(r)}else{var i=l.children(),o=l.children(n.listSelector).last();if(o.children().last().is("#sortableListsPlaceholder")){r.css("display","none");return}o.length?i.last().append(r):(l.append(r),r.wrap(a)),d.oEl&&g(l)}r.css("display","block"),d.isAllowed=n.isAllowed(d.cEl.el,r,r.parents("li").first())}(t,i)}}(s,d),o=s,(p=(c=d).cEl).el.css({top:o.pageY-p.xyOffsetDiff.Y-p.mT,left:o.pageX-p.xyOffsetDiff.X-p.mL})}}function u(s){var t=d.cEl,l=e("#sortableListsHint",d.rootEl.el),i=r[0].style,o=null,a=!1,h=e("#sortableListsHintWrapper");("touchend"===s.type||"touchcancel"===s.type)&&v(s),"block"==i.display&&l.length&&d.isAllowed?(o=l,a=!0):(o=d.placeholderNode,a=!1),offset=o.offset(),t.el.animate({left:offset.left-d.cEl.mL,top:offset.top-d.cEl.mT},250,function(){var e,s;s=(e=t).el[0].style,e.el.removeClass(n.currElClass+" sortableListsCurrent"),s.top="0",s.left="0",s.position="relative",s.width="auto",o.after(t.el[0]),o[0].style.display="none",i.display="none",l.remove(),h.removeAttr("id").removeClass(n.hintWrapperClass),h.length&&h.prev("div").prepend(c.clone(!0)),a?d.placeholderNode.slideUp(150,function(){d.placeholderNode.remove(),m(),n.onChange(t.el),n.complete(t.el),d.isDragged=!1}):(d.placeholderNode.remove(),m(),n.complete(t.el),d.isDragged=!1)}),f(d),d.doc.unbind("mousemove touchmove",p).unbind("mouseup touchend touchcancel",u)}function h(e){d.pY=e.pageY,d.pX=e.pageX,d.cY=e.clientY,d.cX=e.clientX}function f(e){clearInterval(e.upScroll),clearInterval(e.downScroll),e.upScroll=e.downScroll=!1}function v(e){e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,e.screenX=e.originalEvent.changedTouches[0].screenX,e.screenY=e.originalEvent.changedTouches[0].screenY}function g(e){e.removeClass("sortableListsClosed").addClass("sortableListsOpen"),e.children(n.listSelector).css("display","block");var s=e.children("div").children(".sortableListsOpener").first();"html"==n.opener.as?s.html(n.opener.close):"class"==n.opener.as?s.addClass(n.opener.close).removeClass(n.opener.open):s.css("background-image","url("+n.opener.close+")")}function b(e){e.removeClass("sortableListsOpen").addClass("sortableListsClosed"),e.children(n.listSelector).css("display","none");var s=e.children("div").children(".sortableListsOpener").first();"html"==n.opener.as?s.html(n.opener.open):"class"==n.opener.as?s.addClass(n.opener.open).removeClass(n.opener.close):s.css("background-image","url("+n.opener.open+")")}function m(){e(n.listSelector,d.rootEl.el).each(function(s){e(this).children().length||(e(this).prev("div").children(".sortableListsOpener").first().remove(),e(this).remove())})}},e.fn.iconOpen=function(e){this.removeClass("sortableListsClosed").addClass("sortableListsOpen"),this.children("ul").css("display","block");var s=this.children("div").children(".sortableListsOpener").first();"html"===e.opener.as?s.html(e.opener.close):"class"===e.opener.as&&s.addClass(e.opener.close).removeClass(e.opener.open)},e.fn.iconClose=function(e){this.removeClass("sortableListsOpen").addClass("sortableListsClosed"),this.children("ul").css("display","none");var s=this.children("div").children(".sortableListsOpener").first();"html"===e.opener.as?s.html(e.opener.open):"class"===e.opener.as&&s.addClass(e.opener.open).removeClass(e.opener.close)},e.fn.sortableListsToJson=function(){var s=[];return e(this).children("li").each(function(){var t=e(this),l=t.data();s.push(l);var n=t.children("ul,ol").sortableListsToJson();n.length>0?l.children=n:delete l.children}),s},e.fn.updateLevels=function(s){var t=void 0===s?0:s;e(this).children("li").each(function(){var s=e(this).children("ul");s.length>0&&(s.data("level",t+1),s.updateLevels(t+1))})},e.fn.updateButtons=function(s){var t=void 0===s?0:s,l=["Up","In"],n=["Down"];0===t&&(l.push("Out"),n.push("Out"),e(this).children("li").hideButtons(["Out"])),e(this).children("li").each(function(){var s=e(this).children("ul");s.length>0&&s.updateButtons(t+1)}),e(this).children("li:first").hideButtons(l),e(this).children("li:last").hideButtons(n)},e.fn.hideButtons=function(s){for(var t=0;t<s.length;t++)e(this).find(".btn-group:first").children(".btn"+s[t]).hide()}}(jQuery),MenuEditor.updateButtons=function(e){e.find(".btnMove").show(),e.updateButtons()};